apiVersion: v1
kind: Pod
metadata:
    annotations:
        prometheus.io/port: "1234"
        prometheus.io/scrape: "true"
    generateName: buildkitd-5967ccc4-
    labels:
        app: buildkitd
        pod-template-hash: 5967ccc4
    name: buildkitd-5967ccc4-twkg4
    namespace: buildkit
    ownerReferences:
        - apiVersion: apps/v1
          blockOwnerDeletion: true
          controller: true
          kind: ReplicaSet
          name: buildkitd-5967ccc4
          uid: 65f4d5ca-06e7-49e6-872f-f7088f92b1e4
spec:
    containers:
        - args:
            - --addr=tcp://0.0.0.0:1234
            - --debug
          command:
            - buildkitd
          env:
            - name: BUILDKIT_STEP_LOG_MAX_SIZE
              value: "50000000"
            - name: BUILDKIT_STEP_LOG_MAX_SPEED
              value: "10000000"
          image: moby/buildkit:latest
          imagePullPolicy: Always
          livenessProbe:
            exec:
                command:
                    - buildctl
                    - debug
                    - workers
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 10
          name: buildkitd
          ports:
            - containerPort: 1234
              name: tcp
              protocol: TCP
          readinessProbe:
            exec:
                command:
                    - buildctl
                    - debug
                    - workers
            failureThreshold: 3
            initialDelaySeconds: 5
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          resources:
            limits:
                cpu: "4"
                memory: 8Gi
            requests:
                cpu: 500m
                memory: 1Gi
          securityContext:
            privileged: true
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /var/lib/buildkit
              name: buildkit-cache
            - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
              name: kube-api-access-68tgf
              readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
        - effect: NoExecute
          key: node.kubernetes.io/not-ready
          operator: Exists
          tolerationSeconds: 300
        - effect: NoExecute
          key: node.kubernetes.io/unreachable
          operator: Exists
          tolerationSeconds: 300
    volumes:
        - emptyDir:
            sizeLimit: 20Gi
          name: buildkit-cache
        - name: kube-api-access-68tgf
          projected:
            defaultMode: 420
            sources:
                - serviceAccountToken:
                    expirationSeconds: 3607
                    path: token
                - configMap:
                    items:
                        - key: ca.crt
                          path: ca.crt
                    name: kube-root-ca.crt
                - downwardAPI:
                    items:
                        - fieldRef:
                            apiVersion: v1
                            fieldPath: metadata.namespace
                          path: namespace
