apiVersion: v1
data:
    Dockerfile: "FROM nginx:alpine\n\n# Metadata ekle\nLABEL maintainer=\"Kubernetes BuildKit Test\"\nLABEL version=\"1.0\"\nLABEL description=\"Test web app built in Kubernetes with BuildKit\"\n\n# Custom HTML oluştur\nRUN echo '<!DOCTYPE html>\\\n<html>\\\n<head>\\\n    <title>Kubernetes BuildKit Test</title>\\\n    <style>\\\n        body { font-family: Arial, sans-serif; margin: 40px; background: #f0f0f0; }\\\n        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }\\\n        .header { color: #2196F3; border-bottom: 2px solid #2196F3; padding-bottom: 10px; }\\\n        .info { margin: 20px 0; padding: 15px; background: #e3f2fd; border-left: 4px solid #2196F3; }\\\n        .timestamp { color: #666; font-size: 0.9em; }\\\n    </style>\\\n</head>\\\n<body>\\\n    <div class=\"container\">\\\n        <h1 class=\"header\">\U0001F680 Kubernetes BuildKit Test Success!</h1>\\\n        <div class=\"info\">\\\n            <h3>Build Information:</h3>\\\n            <ul>\\\n                <li><strong>Built with:</strong> BuildKit in Kubernetes Pod</li>\\\n                <li><strong>Registry:</strong> Harbor</li>\\\n                <li><strong>Image:</strong> nginx:alpine</li>\\\n                <li><strong>Build Date:</strong> <span class=\"timestamp\" id=\"buildTime\"></span></li>\\\n            </ul>\\\n        </div>\\\n        <div class=\"info\">\\\n            <h3>Components:</h3>\\\n            <ul>\\\n                <li>✅ Kubernetes (minikube)</li>\\\n                <li>✅ BuildKit daemon</li>\\\n                <li>✅ Harbor registry</li>\\\n                <li>✅ MinIO storage</li>\\\n            </ul>\\\n        </div>\\\n        <p><em>This page was built and deployed using BuildKit in a Kubernetes pod!</em></p>\\\n    </div>\\\n    <script>\\\n        document.getElementById(\"buildTime\").innerHTML = new Date().toLocaleString();\\\n    </script>\\\n</body>\\\n</html>' > /usr/share/nginx/html/index.html\n\n# Nginx konfigürasyonu\nRUN echo 'server {\\\n    listen 80;\\\n    server_name localhost;\\\n    location / {\\\n        root /usr/share/nginx/html;\\\n        index index.html;\\\n    }\\\n    location /health {\\\n        access_log off;\\\n        return 200 \"healthy\";\\\n        add_header Content-Type text/plain;\\\n    }\\\n}' > /etc/nginx/conf.d/default.conf\n\nEXPOSE 80\n\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n"
    build.sh: "#!/bin/bash\nset -e\n\necho \"\U0001F680 Starting BuildKit build process in Kubernetes...\"\necho \"\U0001F4C5 Build started at: $(date)\"\n\n# Build context hazırla\ncd /build-context\n\n# BuildKit daemon'a bağlan\nexport BUILDKIT_HOST=tcp://127.0.0.1:1234\n\n# Daemon'un hazır olmasını bekle\necho \"⏳ Waiting for BuildKit daemon...\"\nfor i in {1..30}; do\n    if buildctl debug info >/dev/null 2>&1; then\n        echo \"✅ BuildKit daemon is ready!\"\n        break\n    fi\n    echo \"Waiting for daemon... ($i/30)\"\n    sleep 2\ndone\n\nif ! buildctl debug info >/dev/null 2>&1; then\n    echo \"❌ BuildKit daemon not ready after 60 seconds\"\n    exit 1\nfi\n\n# Harbor IP'sini al (Kubernetes Service IP)\nHARBOR_IP=\"10.103.94.70\"\nIMAGE_NAME=\"${HARBOR_IP}/library/k8s-buildkit-test:latest\"\n\necho \"\U0001F3D7️  Building image: ${IMAGE_NAME}\"\n\n# Image build et\nbuildctl build \\\n    --frontend dockerfile.v0 \\\n    --local context=. \\\n    --local dockerfile=. \\\n    --output type=image,name=${IMAGE_NAME},push=true,registry.insecure=true\n\necho \"✅ Build and push completed successfully!\"\necho \"\U0001F4C5 Build finished at: $(date)\"\n"
kind: ConfigMap
metadata:
    annotations: {}
    name: build-context
    namespace: default
