apiVersion: apps/v1
kind: Deployment
metadata:
    annotations: {}
    labels:
        app: build-status-service
        component: backend
        tier: service
    name: build-status-service
    namespace: build-pipeline
spec:
    progressDeadlineSeconds: 600
    replicas: 2
    revisionHistoryLimit: 10
    selector:
        matchLabels:
            app: build-status-service
    strategy:
        rollingUpdate:
            maxSurge: 25%
            maxUnavailable: 25%
        type: RollingUpdate
    template:
        metadata:
            annotations:
                kubectl.kubernetes.io/restartedAt: "2025-07-08T15:21:24+03:00"
            creationTimestamp: null
            labels:
                app: build-status-service
                component: backend
                tier: service
        spec:
            containers:
                - env:
                    - name: PORT
                      value: "8080"
                    - name: MINIO_ENDPOINT
                      value: host.minikube.internal:9000
                    - name: MINIO_ACCESS_KEY
                      valueFrom:
                        secretKeyRef:
                            key: access-key
                            name: minio-credentials
                    - name: MINIO_SECRET_KEY
                      valueFrom:
                        secretKeyRef:
                            key: secret-key
                            name: minio-credentials
                    - name: MINIO_BUCKET
                      value: builds
                    - name: MINIO_USE_SSL
                      value: "false"
                    - name: LOG_LEVEL
                      value: info
                    - name: GIN_MODE
                      value: release
                  image: 10.103.94.70/library/build-status-service:latest
                  imagePullPolicy: Never
                  livenessProbe:
                    failureThreshold: 3
                    httpGet:
                        path: /api/v1/health
                        port: 8080
                        scheme: HTTP
                    initialDelaySeconds: 30
                    periodSeconds: 10
                    successThreshold: 1
                    timeoutSeconds: 5
                  name: build-status-service
                  ports:
                    - containerPort: 8080
                      name: http
                      protocol: TCP
                  readinessProbe:
                    failureThreshold: 3
                    httpGet:
                        path: /api/v1/health
                        port: 8080
                        scheme: HTTP
                    initialDelaySeconds: 5
                    periodSeconds: 5
                    successThreshold: 1
                    timeoutSeconds: 3
                  resources:
                    limits:
                        cpu: 200m
                        memory: 256Mi
                    requests:
                        cpu: 100m
                        memory: 128Mi
                  securityContext:
                    allowPrivilegeEscalation: false
                    capabilities:
                        drop:
                            - ALL
                    readOnlyRootFilesystem: false
                    runAsGroup: 0
                    runAsNonRoot: false
                    runAsUser: 0
                  terminationMessagePath: /dev/termination-log
                  terminationMessagePolicy: File
            dnsPolicy: ClusterFirst
            restartPolicy: Always
            schedulerName: default-scheduler
            securityContext: {}
            terminationGracePeriodSeconds: 30
