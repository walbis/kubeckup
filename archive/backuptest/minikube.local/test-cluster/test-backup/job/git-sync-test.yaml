apiVersion: batch/v1
kind: Job
metadata:
    annotations: {}
    labels:
        app: git-sync
        component: test-job
    name: git-sync-test
    namespace: test-backup
spec:
    activeDeadlineSeconds: 600
    backoffLimit: 3
    completionMode: NonIndexed
    completions: 1
    manualSelector: false
    parallelism: 1
    podReplacementPolicy: TerminatingOrFailed
    selector:
        matchLabels:
            batch.kubernetes.io/controller-uid: 9c5c4d4e-de6b-4a07-8de6-2dad56ac1919
    suspend: false
    template:
        metadata:
            creationTimestamp: null
            labels:
                app: git-sync
                batch.kubernetes.io/controller-uid: 9c5c4d4e-de6b-4a07-8de6-2dad56ac1919
                batch.kubernetes.io/job-name: git-sync-test
                component: test-job
                controller-uid: 9c5c4d4e-de6b-4a07-8de6-2dad56ac1919
                job-name: git-sync-test
        spec:
            containers:
                - env:
                    - name: MINIO_ENDPOINT
                      valueFrom:
                        secretKeyRef:
                            key: minio-endpoint
                            name: git-sync-secrets
                    - name: MINIO_BUCKET
                      valueFrom:
                        secretKeyRef:
                            key: minio-bucket
                            name: git-sync-secrets
                    - name: MINIO_USE_SSL
                      valueFrom:
                        secretKeyRef:
                            key: minio-use-ssl
                            name: git-sync-secrets
                    - name: MINIO_ACCESS_KEY
                      valueFrom:
                        secretKeyRef:
                            key: minio-access-key
                            name: git-sync-secrets
                    - name: MINIO_SECRET_KEY
                      valueFrom:
                        secretKeyRef:
                            key: minio-secret-key
                            name: git-sync-secrets
                    - name: GIT_REPOSITORY
                      valueFrom:
                        secretKeyRef:
                            key: git-repository
                            name: git-sync-secrets
                    - name: GIT_BRANCH
                      valueFrom:
                        secretKeyRef:
                            key: git-branch
                            name: git-sync-secrets
                    - name: GIT_USERNAME
                      valueFrom:
                        secretKeyRef:
                            key: git-username
                            name: git-sync-secrets
                    - name: GIT_EMAIL
                      valueFrom:
                        secretKeyRef:
                            key: git-email
                            name: git-sync-secrets
                    - name: GIT_TOKEN
                      valueFrom:
                        secretKeyRef:
                            key: git-token
                            name: git-sync-secrets
                    - name: WORK_DIR
                      valueFrom:
                        secretKeyRef:
                            key: work-dir
                            name: git-sync-secrets
                    - name: RETRY_ATTEMPTS
                      valueFrom:
                        secretKeyRef:
                            key: retry-attempts
                            name: git-sync-secrets
                    - name: RETRY_DELAY
                      valueFrom:
                        secretKeyRef:
                            key: retry-delay
                            name: git-sync-secrets
                  image: git-sync:v3-https-fix
                  imagePullPolicy: Never
                  name: git-sync
                  resources:
                    limits:
                        cpu: "1"
                        memory: 1Gi
                    requests:
                        cpu: 200m
                        memory: 512Mi
                  securityContext:
                    allowPrivilegeEscalation: false
                    capabilities:
                        drop:
                            - ALL
                    readOnlyRootFilesystem: false
                    runAsNonRoot: true
                  terminationMessagePath: /dev/termination-log
                  terminationMessagePolicy: File
                  volumeMounts:
                    - mountPath: /tmp
                      name: tmp
                    - mountPath: /workspace
                      name: workspace
                    - mountPath: /home/git-sync-user
                      name: home
            dnsPolicy: ClusterFirst
            restartPolicy: Never
            schedulerName: default-scheduler
            securityContext:
                fsGroup: 1001
                runAsNonRoot: true
                runAsUser: 1001
            serviceAccount: cluster-backup
            serviceAccountName: cluster-backup
            terminationGracePeriodSeconds: 30
            volumes:
                - emptyDir: {}
                  name: tmp
                - emptyDir: {}
                  name: workspace
                - emptyDir: {}
                  name: home
